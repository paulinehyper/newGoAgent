<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agent Control</title>
</head>
<body>
  <h1>ğŸ–¥ï¸ ì—ì´ì „íŠ¸ ëª…ë ¹ UI</h1>
  <button onclick="requestCPU()">CPU ì‚¬ìš©ëŸ‰ ìš”ì²­</button>
  <p id="status">ğŸ• ëª…ë ¹ ëŒ€ê¸° ì¤‘...</p>

  <script>
    function requestCPU() {
      document.getElementById("status").textContent = "ğŸ“¤ ëª…ë ¹ ì „ì†¡ ì¤‘...";
      fetch('/send-command/cpu')
        .then(res => res.json())
        .then(() => {
          waitForResult(); // ê²°ê³¼ ê¸°ë‹¤ë¦¬ê¸° ì‹œì‘
        });
    }

    function waitForResult() {
      let tries = 0;
      const interval = setInterval(() => {
        fetch('/latest-result')
          .then(res => res.json())
          .then(data => {
            if (data.cpu_usage) {
              document.getElementById("status").textContent =
                `âœ… CPU ì‚¬ìš©ë¥ : ${data.cpu_usage}`;
              clearInterval(interval);
            } else {
              tries++;
              if (tries >= 10) {
                document.getElementById("status").textContent = "â³ ì‘ë‹µ ì§€ì—° ì¤‘...";
                clearInterval(interval);
              }
            }
          });
      }, 1000); // 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ê²°ê³¼ í™•ì¸
    }
  </script>
</body>
</html>
